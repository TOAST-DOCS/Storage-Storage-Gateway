## Storage > Storage Gateway > 콘솔 사용 가이드
## 게이트웨이(Gateway)
### 게이트웨이 생성
새로운 스토리지 게이트웨이를 생성합니다. 게이트웨이에 공유(Share)를 생성해 NHN Cloud 스토리지에 접근할 수 있는 인터페이스를 얻을 수 있습니다.

#### 게이트웨이 정보
스토리지 게이트웨이의 이름, 설명, 연결할 스토리지 유형을 설정합니다.

> [참고]
> 2025년 3월 현재 Object Storage를 연결할 수 있습니다.

#### 인스턴스 정보
스토리지 게이트웨이를 구성하는 인스턴스의 정보입니다. 인스턴스 사양은 변경할 수 없습니다.

#### 블록 스토리지
스토리지 게이트웨이를 구성하는 인스턴스의 블록 스토리지 크기를 설정합니다. 
루트 블록 스토리지는 게이트웨이를 구성하는 인스턴스의 기본 디스크로 사용합니다. HDD 타입만 제공하며 최소 20GB, 최대 2,048GB까지 설정할 수 있습니다.
추가 블록 스토리지는 디스크 캐시로 사용하기 위한 용도이며 SSD 타입만 제공합니다. 최소 50GB, 최대 2,048GB까지 설정할 수 있습니다.

#### 네트워크
스토리지 게이트웨이에 사용할 VPC와 서브넷을 선택합니다. 
게이트웨이를 구성하는 인스턴스에 선택한 VPC의 서브넷과 연결되는 네트워크 인터페이스가 만들어집니다. 네트워크 자원의 생성과 관리에 대한 자세한 내용은 [VPC 사용자 가이드](/Network/VPC/ko/overview/)를 참조하세요.
서비스 게이트웨이는 Object Storage와 같이 사용자 VPC 외부의 스토리지를 인터넷 경유 없이 연결하기 위해 사용합니다. 서비스 게이트웨이에 대한 자세한 내용은 [Service Gateway 사용 가이드](/Network/Service%20Gateway/ko/overview/)를 참조하세요.

#### 플로팅 IP
플로팅 IP 사용 여부를 설정합니다. 게이트웨이에 플로팅 IP를 사용하면 인터넷에서 게이트웨이에 접속할 수 있습니다. 자세한 내용은 [Floating IP 사용 가이드](/Network/Floating%20IP/ko/overview/)를 참조하세요.

#### 보안 그룹
스토리지 게이트웨이의 인스턴스가 속할 보안 그룹을 지정합니다. 선택한 VPC 네트워크 외부에서 게이트웨이를 통해 NHN Cloud 스토리지에 마운트하려면 보안 그룹에 다음과 같은 포트에 대한 규칙이 명시되어 있어야 합니다. 

| 방향 | IP 프로토콜 | 포트 범위 | Ether | 원격 |
| --- | --- | --- | --- | --- |
| 수신 | TCP | 1-65536 | IPv4 | 원격지 IP |

원격지 IP는 CIDR 형식의 대역으로 설정할 수 있습니다. 

> [주의]
> 원격지 IP를 `0.0.0.0/0`과 같이 넓은 대역으로 설정하면 보안에 취약해질 수 있습니다. 최소한의 범위로 설정해야 합니다.

자세한 내용은 [Security Groups 사용 가이드](/Network/Security%20Groups/ko/overview/)를 참조하세요.

#### 이중화
스토리지 게이트웨이 이중화 여부를 선택합니다. 이중화를 사용하면 2개의 인스턴스를 생성해 클러스터를 구성합니다. 클러스터를 구성하는 하나의 인스턴스에 장애가 발생하더라도 다른 인스턴스를 통해 중단 없이 게이트웨이를 사용할 수 있습니다. 장애가 발생해 서비스에서 제외된 인스턴스는 오토힐링 기능을 통해 자동으로 복구되어 클러스터에 투입됩니다.

### 게이트웨이 시작
중지된 스토리지 게이트웨이를 시작합니다.

### 게이트웨이 중지 
스토리지 게이트웨이를 중지합니다. 게이트웨이를 중지하면 클러스터를 구성하는 인스턴스가 중지되며 스토리지와 연결할 수 없습니다.

> [주의]
> 스토리지 게이트웨이를 중지하기 전에 NHN Cloud 스토리지를 연결해 사용 중인 시스템에서 언마운트해야 합니다. 마운트 상태에서 게이트웨이를 중지하면 사용자 시스템에 문제가 생길 수 있습니다. 

### 게이트웨이 삭제
스토리지 게이트웨이를 삭제합니다. 클러스터를 구성하는 모든 인스턴스와 자원이 삭제됩니다. 게이트웨이에 연결되어 있던 NHN Cloud 스토리지는 삭제되지 않습니다. 

> [참고]
> 게이트웨이를 삭제하려면 먼저 게이트웨이에 생성한 모든 공유를 삭제해야 합니다.

## 공유(Share)
### 공유 생성
공유를 생성합니다. 공유는 NHN Cloud 스토리지를 연결할 설정입니다. 공유를 생성하면 마운트 연결 정보를 얻을 수 있고, 이 연결 정보를 이용해 사용자 시스템에 NHN Cloud 스토리지를 마운트해 사용할 수 있습니다.

#### 공유 정보
마운트 연결 정보의 경로에 사용할 공유 이름과 프로토콜을 설정합니다.

> [참고]
> 2025년 3월 현재 NFS 프로토콜을 사용할 수 있습니다.

#### 연결 스토리지 정보
연결할 스토리지 정보를 설정합니다. 
Object Storage는 연결할 컨테이너 이름과 S3 API 자격 증명의 Access Key가 필요합니다. 연결할 컨테이너의 이름은 Amazon S3의 버킷 명명 규칙을 따라야 합니다. S3 API 자격 증명은 Object Storage 콘솔 또는 API를 이용해 발급할 수 있습니다. 자세한 내용은 **Object Storage Amazon S3 호환 API 가이드**의 [버킷 생성](/Storage/Object%20Storage/ko/s3-api-guide/#bucket) 섹션과 [S3 API 자격 증명](/Storage/Object%20Storage/ko/s3-api-guide/#s3-api) 섹션을 참조하세요.

> [주의]
> 연결할 Object Storage의 컨테이너에 IP ACL을 설정하려면 반드시 Service Gateway에 대한 **read/write 허용**을 추가해야 합니다.
> Object Storage의 S3 API 자격 증명을 발급하는 사용자는 연결할 컨테이너에 대한 **read/write** 권한이 필요합니다.
> 스토리지 게이트웨이를 통해 Object Storage의 컨테이너를 연결해 사용하는 동안 컨테이너를 삭제하거나 S3 API 자격 증명을 삭제한다면 사용자 시스템에 문제가 생길 수 있습니다. 삭제하지 않도록 주의해야 합니다.

#### NFS 권한 설정
NFS 프로토콜을 통해 연결할 클라이언트의 권한을 설정합니다. 

| Squash 옵션 | 설명 |
| --- | --- |
| no_root_squash | 클라이언트의 root를 NFS 서버의 root에 매핑합니다. |
| root_squash | 클라이언트의 root를 nobody 또는 지정한 UID/GID에 매핑합니다. |
| all_squash | 클라이언트의 모든 사용자를 nobody 또는 지정한 UID/GID에 매핑합니다. |


#### 파일 권한 설정
연결한 스토리지 내에 저장하는 파일 또는 디렉터리의 기본 권한과 소유권을 설정합니다. 
권한은 읽기, 쓰기, 실행 권한을 8진수로 표현하며 파일 소유자, 소유자의 소속 그룹, 다른 사용자에 대한 소유권을 각각 지정할 수 있습니다. 예를 들어 소유자에게는 모든 권한을 그룹과 다른 사용자에게는 읽기 권한만 부여하고 싶다면 744로 설정합니다.

| 권한 | 심볼릭 값 | 8진수 값 |
| --- | --- | --- |
| 권한 없음 | --- | 0 |
| 실행 | --x | 1 |
| 쓰기 | -w- | 2 |
| 쓰기, 실행 | -wx | 3 |
| 읽기 | r-- | 4 |
| 읽기, 실행 | r-x | 5 |
| 읽기, 쓰기 | rw- | 6 |
| 읽기, 쓰기, 실행 | rwx | 7 |

소유권은 리눅스 사용자 ID로 설정합니다. 일반적으로 **root**는 **0**, **user**는 **1000**으로 설정하지만, 사용자의 환경에 따라 다를 수 있습니다. 리눅스 사용자 ID와 그룹 ID는 리눅스 셸에서 **id** 명령으로 확인할 수 있습니다.

```
$ id
uid=1000(ubuntu) gid=1000(ubuntu) groups=1000(ubuntu)
```

#### ACL
마운트 연결 정보를 통해 마운트할 수 있는 클라이언트의 IP 또는 IP 대역을 CIDR 형식으로 입력합니다.

#### 캐시 설정
캐시 유효 시간을 설정합니다. 설정된 유효 시간 동안 캐시가 유지됩니다. 

### 공유 삭제
공유를 삭제합니다. 

> [주의]
> 공유를 삭제하기 전에 NHN Cloud 스토리지를 마운트해 사용 중인 시스템에서 언마운트해야 합니다. 마운트 상태에서 공유를 삭제하면 사용자 시스템에 문제가 생길 수 있습니다. 

### 캐시 즉시 새로 고침
디스크 캐시 영역에 저장된 데이터를 즉시 삭제합니다. 

## NFS 연결
NFS를 사용하려면 다음과 같이 NFS 패키지를 설치하고 rpcbind 서비스를 실행해야 합니다.

### NFS 패키지 설치
* **Debian, Ubuntu**
```
sudo apt-get install nfs-common rpcbind
```

* **CentOS**
```
sudo yum install nfs-utils rpcbind
```

### rpcbind 서비스 실행
```
sudo service rpcbind start
```

### 공유 마운트
생성한 공유의 마운트 연결 정보와 mount 명령을 이용해 다음과 같이 NHN Cloud 스토리지를 사용자 시스템에 마운트할 수 있습니다.

```
sudo mount -t nfs {마운트 연결 정보} {마운트할 경로}
```

NFS v3를 사용하려면 다음과 같이 버전 옵션을 추가해야 합니다.

```
sudo mount -t nfs -o vers=3 {마운트 연결 정보} {마운트할 경로}
```

* 마운트 연결 정보는 공유의 상세 정보에서 확인할 수 있습니다. 
  예: 192.168.0.11:/data

* 마운트할 경로
  예: /mnt/data


